# AI 智能菜谱推荐系统 —— 数据库设计文档

> 版本：1.1  
> 最后更新：2026年1月30日  
> 设计目标：支持用户食材管理、AI 菜谱生成、收藏评分、购物清单、智能推荐等核心功能  
> 登录方式：手机号/密码  
> 枚举值统一采用 **数字编码（TINYINT）**，提升性能与可维护性

---

## 📌 全局编码对照表

### 1. 性别 (`gender`)

| 编码 | 含义   |
|------|--------|
| 1    | 男     |
| 2    | 女     |
| 3    | 其他   |

### 2. 食材分类 (`category`)

| 编码 | 含义   |
|------|--------|
| 1    | 蔬菜   |
| 2    | 肉类   |
| 3    | 海鲜   |
| 4    | 主食   |
| 5    | 调味料 |

### 3. 用户食材状态 (`status`)

| 编码 | 含义   |
|------|--------|
| 1    | 已有   |
| 2    | 缺少   |

### 4. 菜系 (`cuisine`)

| 编码 | 含义   |
|------|--------|
| 1    | 中餐   |
| 2    | 西餐   |
| 3    | 日韩   |
| 4    | 东南亚 |

### 5. 基础味型 (`taste_base`)

| 编码 | 含义   |
|------|--------|
| 1    | 甜     |
| 2    | 咸     |
| 3    | 酸     |
| 4    | 鲜     |
| 5    | 清淡   |
| 6    | 复合   |

### 6. 辣度等级 (`spice_level`)

| 编码 | 含义   |
|------|--------|
| 0    | 不辣   |
| 1    | 微辣   |
| 2    | 中辣   |
| 3    | 重辣   |
| 4    | 爆辣   |

### 7. 菜谱难度 (`difficulty`)

| 编码 | 含义   |
|------|--------|
| 1    | 简单   |
| 2    | 中等   |
| 3    | 复杂   |

### 8. 菜谱来源 (`source_type`)

| 编码 | 含义   |
|------|--------|
| 1    | AI生成 |
| 2    | 用户上传 |
| 3    | 官方   |

### 9. 用餐时间 (`meal_time`)

| 编码 | 含义   |
|------|--------|
| 1    | 早餐   |
| 2    | 午餐   |
| 3    | 晚餐   |
| 4    | 夜宵   |

---

## 🗂️ 表结构详解

### 1. `user` —— 用户表

存储用户基本信息及身体数据，用于个性化推荐。

| 字段名       | 类型         | 说明 |
|--------------|--------------|------|
| `id`         | BIGINT       | 用户唯一ID（主键） |
| `username`   | VARCHAR(50)  | 昵称，全局唯一 |
| `phone`      | VARCHAR(20)  | 手机号，用于登录，全局唯一 |
| `password`   | VARCHAR(255) | 加密后的密码 |
| `height_cm`  | INT          | 身高（厘米） |
| `weight_kg`  | DECIMAL(5,2) | 体重（公斤） |
| `gender`     | TINYINT      | 性别（见对照表） |
| `created_at` | TIMESTAMP    | 注册时间 |

---

### 2. `ingredient` —— 标准食材库

维护结构化食材数据，含营养与过敏信息。

| 字段名                | 类型            | 说明 |
|-----------------------|------------------|------|
| `id`                  | BIGINT          | 食材ID（主键） |
| `name`                | VARCHAR(100)    | 食材名称 |
| `category`            | TINYINT         | 分类编码（见对照表） |
| `unit`                | VARCHAR(20)     | 默认单位（如“份”），默认“份” |
| `calories_per_100g`   | DECIMAL(8,2)    | 每100克热量 |
| `protein_per_100g`    | DECIMAL(8,2)    | 每100克蛋白质 |
| `carbs_per_100g`      | DECIMAL(8,2)    | 每100克碳水 |
| `fat_per_100g`        | DECIMAL(8,2)    | 每100克脂肪 |
| `allergens`           | TEXT            | 过敏原列表（逗号分隔） |
| `image_url`           | VARCHAR(255)    | 食材图片URL |
| `created_at`          | TIMESTAMP       | 数据录入时间 |

---

### 3. `user_ingredient` —— 用户食材记录

记录用户冰箱拥有的食材。

| 字段名         | 类型       | 说明 |
|----------------|------------|------|
| `id`           | BIGINT     | 记录ID（主键） |
| `user_id`      | BIGINT     | 关联用户ID |
| `ingredient_id`| BIGINT     | 关联标准食材ID |
| `amount`       | DECIMAL(10,2)| 数量 |
| `unit`         | VARCHAR(20)| 单位 |
| `status`       | TINYINT    | 状态：1=已有，2=缺少 |

---

### 4. `recipe` —— 菜谱表（核心）

存储所有菜谱信息，支持 AI 生成与人工录入。

| 字段名                | 类型            | 说明 |
|-----------------------|-----------------|------|
| `id`                  | BIGINT          | 菜谱ID（主键） |
| `name`                | VARCHAR(100)    | 菜名 |
| `cuisine`             | TINYINT         | 菜系编码 |
| `taste_base`          | TINYINT         | 基础味型编码 |
| `spice_level`         | TINYINT         | 辣度等级 |
| `cooking_time_minutes`| INT             | 烹饪耗时（分钟） |
| `difficulty`          | TINYINT         | 难度编码 |
| `ingredients_json`    | TEXT            | 所需食材（JSON 格式） |
| `steps_text`          | TEXT            | 烹饪步骤（Markdown） |
| `nutrition_analysis`  | JSON            | 营养分析结果 |
| `estimated_cost_cny`  | DECIMAL(6,2)    | 预估成本（元） |
| `cover_image_url`     | VARCHAR(255)    | 封面图URL |
| `source_type`         | TINYINT         | 来源：1=AI, 2=用户, 3=官方 |
| `author_user_id`      | BIGINT          | 作者ID（如果是用户上传） |
| `ai_generated`        | TINYINT(1)      | 是否AI生成 |
| `created_at`          | TIMESTAMP       | 创建时间 |

---

### 5. `recipe_recommendation` —— AI推荐记录

记录系统为用户生成的推荐历史。

| 字段名                 | 类型          | 说明 |
|------------------------|---------------|------|
| `id`                   | BIGINT        | 主键 |
| `user_id`              | BIGINT        | 用户ID |
| `recommended_recipe_id`| BIGINT        | 推荐的菜谱ID |
| `meal_time`            | TINYINT       | 用餐时段（见对照表） |
| `budget_limit`         | DECIMAL(8,2)  | 预算限制 |
| `is_healthy_for_user`  | TINYINT(1)    | 是否符合用户健康需求 |
| `reason`               | TEXT          | 推荐理由 |
| `generated_at`         | TIMESTAMP     | 生成时间 |

---

### 6. `recipe_tried` —— 用户尝试记录（评分）

用户做过/吃过某个菜谱的反馈。

| 字段名       | 类型       | 说明 |
|--------------|------------|------|
| `id`         | BIGINT     | 主键 |
| `user_id`    | BIGINT     | 用户ID |
| `recipe_id`  | BIGINT     | 菜谱ID |
| `rating`     | TINYINT    | 评分（例如1-5星） |
| `comment`    | TEXT       | 评论内容 |
| `tried_at`   | TIMESTAMP  | 记录时间 |

---

### 7. `user_favorite_recipe` —— 用户收藏菜谱

| 字段名       | 类型       | 说明 |
|--------------|------------|------|
| `id`         | BIGINT     | 主键 |
| `user_id`    | BIGINT     | 用户ID |
| `recipe_id`  | BIGINT     | 菜谱ID |
| `created_at` | TIMESTAMP  | 收藏时间 |

---

### 8. `shopping_list` —— 购物清单

| 字段名       | 类型         | 说明 |
|--------------|--------------|------|
| `id`         | BIGINT       | 主键 |
| `user_id`    | BIGINT       | 用户ID |
| `name`       | VARCHAR(100) | 清单名称 |
| `created_at` | TIMESTAMP    | 创建时间 |
| `updated_at` | TIMESTAMP    | 更新时间 |

---

### 9. `shopping_list_item` —— 购物清单条目

| 字段名              | 类型         | 说明 |
|---------------------|--------------|------|
| `id`                | BIGINT       | 主键 |
| `shopping_list_id`  | BIGINT       | 关联购物清单ID |
| `ingredient_name`   | VARCHAR(100) | 食材名称（文本记录，不强制关联库） |
| `amount`            | VARCHAR(50)  | 数量描述（如 "500g", "2个"） |
| `unit`              | VARCHAR(20)  | 单位 |
| `category`          | VARCHAR(50)  | 分类（可选） |
| `note`              | TEXT         | 备注 |
