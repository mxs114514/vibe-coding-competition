# 菜谱功能测试检查清单

## 🚀 服务状态

- ✅ 后端服务: http://localhost:8081
- ✅ 前端服务: http://localhost:5175
- ✅ 数据库表已创建

---

## 📋 测试步骤

### 准备工作
- [ ] 打开浏览器访问 http://localhost:5175
- [ ] 确保已登录（如未登录，先注册/登录）
- [ ] 打开浏览器开发者工具（F12）查看控制台和网络请求

---

### 测试 1: 生成菜谱并自动保存 ⭐
**目标**: 验证生成菜谱时自动保存到数据库

**步骤**:
1. 点击底部导航的"冰箱"图标
2. 添加一些食材（如：鸡蛋、番茄、土豆）
3. 点击底部导航的"菜谱"图标，打开菜谱中心
4. 点击"🎲 生成菜谱"按钮
5. 等待菜谱生成完成

**预期结果**:
- [ ] 显示3道菜谱
- [ ] 每个菜谱显示图片（或"图片生成中..."）
- [ ] 菜谱卡片显示菜名、烹饪时间、难度、菜系
- [ ] 显示已有食材和需购买食材

**验证数据库**:
```sql
-- 查看最新生成的菜谱
SELECT id, name, cuisine, created_at FROM recipe ORDER BY id DESC LIMIT 3;

-- 查看历史记录
SELECT * FROM recipe_generation_history ORDER BY id DESC LIMIT 1;
```

**检查点**:
- [ ] 菜谱ID是数字（不是 temp-xxx 格式）
- [ ] 数据库中有对应的菜谱记录
- [ ] 历史记录表中有记录

---

### 测试 2: 收藏菜谱 ⭐
**目标**: 验证收藏功能正常工作

**步骤**:
1. 在生成的菜谱列表中，找到第一个菜谱
2. 点击菜谱卡片右下角的星标按钮（空心灰色）
3. 观察星标变化

**预期结果**:
- [ ] 星标从空心灰色变为实心黄色 ⭐
- [ ] 无错误提示
- [ ] 控制台无错误信息

**验证数据库**:
```sql
-- 查看收藏记录
SELECT * FROM user_favorite_recipe ORDER BY created_at DESC LIMIT 1;
```

**检查点**:
- [ ] 数据库中有收藏记录
- [ ] user_id 和 recipe_id 正确

---

### 测试 3: 查看收藏列表 ⭐
**目标**: 验证收藏列表显示正确

**步骤**:
1. 点击"我的收藏"Tab
2. 等待加载完成

**预期结果**:
- [ ] 显示收藏的菜谱列表
- [ ] 标题显示"收藏的菜谱 (1道)"
- [ ] 收藏的菜谱星标为实心黄色
- [ ] 显示菜系筛选按钮（全部、中餐、西餐、日韩、东南亚）

**检查点**:
- [ ] 收藏列表不为空
- [ ] 显示的菜谱与刚才收藏的一致

---

### 测试 4: 按菜系筛选收藏 ⭐
**目标**: 验证菜系筛选功能

**步骤**:
1. 在"我的收藏"Tab中
2. 点击不同的菜系按钮（如"中餐"）
3. 观察列表变化

**预期结果**:
- [ ] 只显示对应菜系的菜谱
- [ ] 筛选按钮高亮显示（橙色背景）
- [ ] 总数正确更新

**检查点**:
- [ ] 筛选功能正常
- [ ] 点击"全部"恢复显示所有收藏

---

### 测试 5: 取消收藏 ⭐
**目标**: 验证取消收藏功能

**步骤**:
1. 在"我的收藏"Tab中
2. 点击某个菜谱的星标按钮（实心黄色）
3. 观察变化

**预期结果**:
- [ ] 星标从实心黄色变为空心灰色
- [ ] 菜谱从收藏列表中消失
- [ ] 总数减1

**验证数据库**:
```sql
-- 确认收藏记录已删除
SELECT * FROM user_favorite_recipe WHERE recipe_id = {刚才的菜谱ID};
-- 应该返回空结果
```

**检查点**:
- [ ] 数据库中收藏记录已删除
- [ ] 切换到"生成菜谱"Tab，该菜谱星标为空心

---

### 测试 6: 查看历史记录 ⭐
**目标**: 验证历史记录显示正确

**步骤**:
1. 点击"历史记录"Tab
2. 等待加载完成

**预期结果**:
- [ ] 显示生成历史列表
- [ ] 每条记录显示：
  - [ ] 生成时间（如"2026/1/30 16:53:00"）
  - [ ] 使用的食材列表
  - [ ] 生成的菜谱数量（3道）
  - [ ] 生成的菜谱名称列表
  - [ ] "重新生成"按钮

**检查点**:
- [ ] 历史记录不为空
- [ ] 显示的食材与之前生成时使用的一致

---

### 测试 7: 重新生成菜谱 ⭐
**目标**: 验证重新生成功能

**步骤**:
1. 在"历史记录"Tab中
2. 点击第一条历史记录的"重新生成"按钮
3. 等待生成完成

**预期结果**:
- [ ] 自动切换到"生成菜谱"Tab
- [ ] 显示新生成的3道菜谱
- [ ] 使用相同的食材列表
- [ ] 生成的菜谱可能不同（AI随机性）

**验证数据库**:
```sql
-- 查看历史记录数量
SELECT COUNT(*) FROM recipe_generation_history;
-- 应该增加1条
```

**检查点**:
- [ ] 创建了新的历史记录
- [ ] 新菜谱已保存到数据库

---

### 测试 8: 收藏状态同步 ⭐
**目标**: 验证收藏状态在不同Tab间同步

**步骤**:
1. 在"生成菜谱"Tab中收藏一个菜谱
2. 切换到"我的收藏"Tab
3. 确认菜谱出现在收藏列表
4. 切换回"生成菜谱"Tab
5. 确认星标仍为实心黄色

**预期结果**:
- [ ] 收藏列表中显示该菜谱
- [ ] 切换回来后，星标保持实心黄色
- [ ] 收藏状态在所有Tab间一致

**检查点**:
- [ ] 状态同步正常
- [ ] 无需刷新页面

---

### 测试 9: 未登录时收藏 ⭐
**目标**: 验证未登录时的提示

**步骤**:
1. 退出登录（如果有退出按钮）
2. 生成菜谱
3. 点击收藏按钮

**预期结果**:
- [ ] 显示提示"请先登录"
- [ ] 收藏操作未执行
- [ ] 星标保持空心灰色

**检查点**:
- [ ] 未登录时无法收藏
- [ ] 提示信息清晰

---

### 测试 10: 空状态显示 ⭐
**目标**: 验证空状态提示

**步骤 A - 空收藏列表**:
1. 取消所有收藏
2. 查看"我的收藏"Tab

**预期结果**:
- [ ] 显示空状态图标（心形）
- [ ] 提示"还没有收藏的菜谱"
- [ ] 提示"快去生成一些喜欢的菜谱吧"

**步骤 B - 空历史记录**:
1. 清空历史记录（通过数据库）
2. 查看"历史记录"Tab

**预期结果**:
- [ ] 显示空状态图标（时钟）
- [ ] 提示"还没有生成历史"
- [ ] 提示"生成菜谱后会自动记录"

---

### 测试 11: 图片轮询 ⭐
**目标**: 验证图片生成和轮询机制

**步骤**:
1. 生成菜谱后，观察图片加载状态
2. 等待图片生成完成

**预期结果**:
- [ ] 初始显示"图片生成中..."和旋转图标
- [ ] 3秒后自动查询图片状态
- [ ] 图片生成完成后自动显示
- [ ] 最多60秒后停止轮询

**检查点**:
- [ ] 图片轮询正常工作
- [ ] 控制台无错误信息

---

### 测试 12: 响应式设计 ⭐
**目标**: 验证移动端适配

**步骤**:
1. 按F12打开开发者工具
2. 切换到移动设备模式
3. 测试各个功能

**预期结果**:
- [ ] 菜谱卡片在移动端单列显示
- [ ] 按钮大小适中，易于点击
- [ ] 遮罩层从底部滑出
- [ ] 所有功能正常工作

---

## 🐛 常见问题排查

### 问题1: 收藏时提示"菜谱不存在"
**检查**:
- 确保已登录
- 查看控制台网络请求
- 检查菜谱ID是否为数字

### 问题2: 历史记录为空
**检查**:
- 确保已登录
- 确认数据库表已创建
- 查看后端日志

### 问题3: 图片一直显示"生成中"
**检查**:
- 查看控制台网络请求
- 检查后端图片生成服务
- 确认轮询是否启动

### 问题4: 收藏状态不同步
**检查**:
- 刷新页面重试
- 查看控制台错误
- 检查 favoriteIds 状态

---

## ✅ 测试完成标准

所有测试项通过后，功能实现完成：
- [ ] 生成菜谱自动保存 ✅
- [ ] 收藏/取消收藏功能正常 ✅
- [ ] 收藏列表显示和筛选正常 ✅
- [ ] 历史记录显示正常 ✅
- [ ] 重新生成功能正常 ✅
- [ ] 收藏状态同步正常 ✅
- [ ] 未登录时正确提示 ✅
- [ ] 空状态显示正常 ✅
- [ ] 图片轮询正常 ✅
- [ ] 响应式设计正常 ✅

---

## 📊 数据库查询命令

### 查看最近生成的菜谱
```sql
SELECT id, name, cuisine, difficulty, cooking_time_minutes, created_at
FROM recipe
ORDER BY id DESC
LIMIT 10;
```

### 查看收藏记录
```sql
SELECT ufr.id, ufr.user_id, r.name as recipe_name, ufr.created_at
FROM user_favorite_recipe ufr
JOIN recipe r ON ufr.recipe_id = r.id
ORDER BY ufr.created_at DESC
LIMIT 10;
```

### 查看历史记录
```sql
SELECT h.id, h.user_id, h.ingredients_json, h.recipes_count, h.generated_at,
       GROUP_CONCAT(r.name SEPARATOR ', ') as recipe_names
FROM recipe_generation_history h
LEFT JOIN recipe_generation_history_recipes hr ON h.id = hr.history_id
LEFT JOIN recipe r ON hr.recipe_id = r.id
GROUP BY h.id
ORDER BY h.generated_at DESC
LIMIT 10;
```

### 清空测试数据（谨慎使用）
```sql
-- 清空收藏记录
DELETE FROM user_favorite_recipe WHERE user_id = {你的用户ID};

-- 清空历史记录
DELETE FROM recipe_generation_history WHERE user_id = {你的用户ID};
```

---

## 📝 测试报告

**测试日期**: 2026-01-30
**测试人员**: _______
**浏览器**: Chrome / Firefox / Safari

**测试结果汇总**:
- 通过: _____ / 12
- 失败: _____ / 12
- 跳过: _____ / 12

**发现的问题**:
1. _______________________
2. _______________________
3. _______________________

**总体评价**: ☐ 通过 ☐ 部分通过 ☐ 未通过
